<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Schizofrenie</title>
    <link rel="stylesheet" href="game.css">
</head>

<body>
    <canvas id="gameSpace" width="800" height="800"></canvas>
    <br>
    <button id="upperButton">↑</button>
    <br>
    <button id="lefterButton">←</button>
    <button id="righterButton">→</button>
    <br>
    <button id="downerButton">↓</button>

    <script>

        notTurnedYet = true;

        const gameWebSocket = new WebSocket("ws://localhost:8186");

        const upperButton = document.querySelector("#upperButton");
        const lefterButton = document.querySelector("#lefterButton");
        const righterButton = document.querySelector("#righterButton");
        const downerButton = document.querySelector("#downerButton");

        upperButton.addEventListener("click", () => tryMove("UP"));
        lefterButton.addEventListener("click", () => tryMove("LEFT"));
        righterButton.addEventListener("click", () => tryMove("RIGHT"));
        downerButton.addEventListener("click", () => tryMove("DOWN"));

        document.body.addEventListener("keydown", e => handleKeyDown(e));

        function handleKeyDown(e) {
            switch (e.code) {
                case "ArrowUp":
                    tryMove('UP'); break;      //up
                case "ArrowLeft":
                    tryMove('LEFT'); break;     //left
                case "ArrowRight":
                    tryMove('RIGHT'); break;    //right
                case "ArrowDown":
                    tryMove('DOWN'); break;     //down
            }
        }

        function tryMove(direction) {
            if (notTurnedYet) {
                sendMove(direction);
                notTurnedYet = true;
            }
        }

        function sendMove(direction) {
            gameWebSocket.send(direction);
        }

        const gameSpace = document.querySelector("gameSpace");

        gameWebSocket.addEventListener("open", e => {
            console.log("open, client");
            //do nothing
        });

        gameWebSocket.addEventListener("error", e => {
            console.log("error occured, client");
            //learn what error it can be, how it can occur in the game and deal with it
        });

        gameWebSocket.addEventListener("message", message => {
            console.log("message: " + JSON.parse(data)[0]);
            console.log("m: " + message.data[1]);
            
            //handle information arriving from the server
            //only info messages from the server should be accepted here
        });
    </script>
</body>

</html>