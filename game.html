<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Schizofrenie</title>
    <link rel="stylesheet" href="game.css">
</head>

<body>
    <canvas id="gameSpace" width="800" height="800"></canvas>
    <br>
    <button id="upperButton">↑</button>
    <br>
    <button id="lefterButton">←</button>
    <button id="righterButton">→</button>
    <br>
    <button id="downerButton">↓</button>

    <script>

        notTurnedYet = true;

        const gameWebSocket = new WebSocket("ws://localhost:8186");

        const upperButton = document.querySelector("#upperButton");
        const lefterButton = document.querySelector("#lefterButton");
        const righterButton = document.querySelector("#righterButton");
        const downerButton = document.querySelector("#downerButton");

        upperButton.addEventListener("click", () => tryMove("up"));
        lefterButton.addEventListener("click", () => tryMove("left"));
        righterButton.addEventListener("click", () => tryMove("right"));
        downerButton.addEventListener("click", () => tryMove("down"));

        function handleKeyDown(e) {
            switch (e.code) {
                case "ArrowUp":
                    tryMove('up'); break;      //up
                case "ArrowLeft":
                    tryMove('left'); break;     //left
                case "ArrowRight":
                    tryMove('right'); break;    //right
                case "ArrowDown":
                    tryMove('down'); break;     //down
            }
        }

        function tryMove(direction) {
            //todo: create and use a global variable if possible (control has to be on server side as well)
            if (notTurnedYet) {
                sendMove(direction);
            }
        }

        function sendMove(direction) {
            gameWebSocket.send(direction);
        }

        document.body.addEventListener("keydown", e => handleKeyDown(e));



        const gameSpace = document.querySelector("gameSpace");

        gameWebSocket.addEventListener("open", e => {
            console.log("open, client")
            //ask for the current state of the game and show it using canvas
        });

        gameWebSocket.addEventListener("error", e => {
            console.log("error occured, client")
            //learn what error it can be, how it can occur in the game and deal with it
        });

        gameWebSocket.addEventListener("message", e => {
            console.log("message, client")
            //handle information arriving from the server
            //only info messages from the server should be accepted here
        });
    </script>
</body>

</html>